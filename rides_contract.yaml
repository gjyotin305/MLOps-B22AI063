# ==============================================
# DATA CONTRACT: CityMove Ride Events
# ==============================================
# NEGOTIATION SUMMARY
# ----------------------------------------------
# Producer: Data Engineering Team (PostgreSQL ops)
# Consumer: ML Team (Dynamic Pricing Model)
# Incident: Column rename caused pricing outage for 4 hours
# Agreed Terms:
# - Freshness: data available within 30 minutes of ride completion
# - Quality rules are hard enforced to prevent model crashes
# - Passenger ID is PII and must be protected
# ----------------------------------------------

dataContractSpecification: 0.9.3
id: urn:datacontract:citymove:rides
version: 1.0.0

info:
  title: "CityMove Ride Events"
  description: |
    Operational ride events used by the dynamic pricing ML model.
    Provides stable logical fields mapped from operational DB columns.
  owner: "Data Engineering Team"
  contact:
    name: "Data Engineering Oncall"
    email: "data-eng@citymove.com"
    slack: "#data-eng-support"
  classification: internal
  tags: [rides, pricing, ml, contract]

schema:
  type: object
  properties:
    ride_id:
      type: string
      description: "Unique ride identifier."
      pii: false
      physical_mapping: r_id
    pickup_timestamp:
      type: string
      format: date-time
      description: "Ride pickup timestamp (UTC)."
      pii: false
      physical_mapping: ts_start
    passenger_id:
      type: integer
      description: "Passenger identifier. PII."
      pii: true
      physical_mapping: pax_id
    driver_rating:
      type: number
      description: "Driver rating on a 1.0 to 5.0 scale."
      pii: false
      physical_mapping: d_rating
    fare_final_usd:
      type: number
      description: "Total fare charged in USD."
      minimum: 0
      pii: false
      physical_mapping: fare_final
    distance_meters:
      type: integer
      description: "Distance traveled in meters."
      pii: false
      physical_mapping: dist_m
  required:
    - ride_id
    - pickup_timestamp
    - passenger_id
    - driver_rating
    - fare_final_usd
    - distance_meters

sla:
  freshness:
    threshold: "30 minutes"
    description: "Data available within 30 minutes of ride completion."
  availability:
    percentage: "99.9%"
    description: "High availability required for pricing model retraining."
  retention:
    period: "2 years"
    description: "Historical rides retained for model training and audits."

quality:
  - name: fare_non_negative
    type: validity
    expression: "fare_final_usd >= 0"
    threshold: "100%"
    enforcement: hard
    description: "Fare must never be negative."
  - name: driver_rating_in_range
    type: validity
    expression: "driver_rating >= 1.0 AND driver_rating <= 5.0"
    threshold: "100%"
    enforcement: hard
    description: "Driver rating must be between 1.0 and 5.0 inclusive."
  - name: distance_not_null
    type: completeness
    column: distance_meters
    threshold: "100%"
    enforcement: hard
    description: "Distance must not be NULL."
